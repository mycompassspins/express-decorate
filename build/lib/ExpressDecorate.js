"use strict";
const FileSystemHelper_1 = require('./helpers/FileSystemHelper');
const ErrorMessageHelper_1 = require('./helpers/ErrorMessageHelper');
const express_1 = require('express');
const util = require('util');
const chalk = require('chalk');
class ExpressDecorate {
    constructor(app, opts) {
        this.app = app;
        this.opts = opts;
        this._setDefaults(app);
        this._loadControllers(app);
    }
    _setDefaults(app) {
        if (!this.opts.hasOwnProperty('extension'))
            this.opts.extension = 'js';
        if (!this.opts.hasOwnProperty('ctrlLoadRecursive'))
            this.opts.ctrlLoadRecursive = true;
        if (this.opts.hasOwnProperty('ctrlIgnore')) {
            this.opts.ctrlIgnore = this.opts.ctrlIgnore instanceof RegExp ?
                this.opts.ctrlIgnore : new RegExp(`${this.opts.ctrlIgnore}`);
        }
        if (!this.opts.hasOwnProperty('mergeParams'))
            this.opts.mergeParams = true;
        if (this.opts.hasOwnProperty('routeConfig'))
            this.opts.routeConfig(app);
        if (!this.opts.hasOwnProperty('debug'))
            this.opts.debug = false;
    }
    _loadControllers(app) {
        const opts = this.opts, EXT_PATTERN = /\.[t|j]s?/, CTRL_PATTERN = /controller/, MAP_PATTERN = /\.map$/, API_DIR = opts.ctrlDir, IGNORE_PATTERN = opts.ctrlIgnore || null;
        try {
            let apiContents = FileSystemHelper_1.FileSystemHelper.GetDirectoryContents(API_DIR, opts.ctrlLoadRecursive);
            apiContents.filter((file) => {
                return file.fileName.indexOf(opts.extension) !== -1;
            }).forEach((file) => {
                let fileName = file.fileName
                    .replace(EXT_PATTERN, '')
                    .replace('BaseController', '');
                if (CTRL_PATTERN.test(fileName.toLowerCase()) &&
                    !MAP_PATTERN.test(fileName) &&
                    (!IGNORE_PATTERN || !IGNORE_PATTERN.test(fileName))) {
                    let path = file.fullPath
                        .replace(`${API_DIR}/`, '')
                        .replace(file.fileName, '')
                        .replace(opts.ctrlIgnore, '');
                    try {
                        let ctrlConstructor = require(`${API_DIR}/${path}/${fileName}`), ctrlName = Object.keys(ctrlConstructor)[0], controller = new ctrlConstructor[ctrlName];
                        for (const { method, mountpath, path, middleware, requiredBodyParams, fnName } of controller.$routes) {
                            app.use(mountpath, this._routerAdd(opts, method, mountpath, path, middleware, fnName, controller));
                        }
                        if (opts.debug) {
                            ErrorMessageHelper_1.Log(null, 'debug', opts, `Routes for ${ctrlName}`);
                            controller.$routes.forEach((route) => console.log(util.inspect(route)));
                        }
                    }
                    catch (e) {
                        ErrorMessageHelper_1.Log(e, 'error', this.opts, `configuring routes for ${fileName}`);
                    }
                }
            });
        }
        catch (e) {
            ErrorMessageHelper_1.Log(e, 'error', this.opts);
        }
    }
    _routerAdd(opts, method, mountpath, path, middleware, fnName, controller) {
        let router = express_1.Router({ mergeParams: opts.mergeParams });
        router[method === 'alternate' ? opts.alternateMethod : method](path, ...middleware, controller[fnName]);
        return router;
    }
}
exports.ExpressDecorate = ExpressDecorate;

//# sourceMappingURL=data:application/json;base64,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QUFDLE1BQU0sQ0FBQztJQUNmLENBQUM7QUFDRixDQUFDO0FBaElZLHVCQUFlLGtCQWdJM0IsQ0FBQSIsImZpbGUiOiJsaWIvRXhwcmVzc0RlY29yYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IEp1c3RpbiBvbiA4LzI3LzE2LlxuICovXG5cbmltcG9ydCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuaW1wb3J0IHsgRmlsZVN5c3RlbUhlbHBlciBhcyBmc0hlbHBlciB9IGZyb20gJy4vaGVscGVycy9GaWxlU3lzdGVtSGVscGVyJ1xuaW1wb3J0IHsgSUV4cHJlc3NEZWNvcmF0ZU9wdGlvbnMgfSBmcm9tICcuL2ludGVyZmFjZXMvSUV4cHJlc3NEZWNvcmF0ZVJlcG9zaXRvcnknXG5pbXBvcnQgeyBCYXNlQ29udHJvbGxlciB9IGZyb20gJy4vYXBpL0Jhc2VDb250cm9sbGVyJ1xuaW1wb3J0IHsgTG9nIH0gZnJvbSAnLi9oZWxwZXJzL0Vycm9yTWVzc2FnZUhlbHBlcidcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnXG5cbmNvbnN0IHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XG5jb25zdCBjaGFsayA9IHJlcXVpcmUoJ2NoYWxrJyk7XG5cbmV4cG9ydCBjbGFzcyBFeHByZXNzRGVjb3JhdGVcbntcblx0Y29uc3RydWN0b3IocHJpdmF0ZSBhcHA6ZXhwcmVzcy5BcHBsaWNhdGlvbiwgcHJpdmF0ZSBvcHRzOklFeHByZXNzRGVjb3JhdGVPcHRpb25zKVxuXHR7XG5cdFx0Ly8gU2V0IG9wdGlvbnMgZGVmYXVsdHNcblx0XHR0aGlzLl9zZXREZWZhdWx0cyhhcHApO1xuXG5cdFx0Ly8gTG9hZCBhbmQgaW5zdGFudGlhdGUgY29udHJvbGxlcnNcblx0XHR0aGlzLl9sb2FkQ29udHJvbGxlcnMoYXBwKTtcblx0fVxuXG5cdHByaXZhdGUgX3NldERlZmF1bHRzKGFwcDpleHByZXNzLkFwcGxpY2F0aW9uKTp2b2lkXG5cdHtcblx0XHRpZiAoIXRoaXMub3B0cy5oYXNPd25Qcm9wZXJ0eSgnZXh0ZW5zaW9uJykpXG5cdFx0XHR0aGlzLm9wdHMuZXh0ZW5zaW9uID0gJ2pzJztcblxuXHRcdGlmICghdGhpcy5vcHRzLmhhc093blByb3BlcnR5KCdjdHJsTG9hZFJlY3Vyc2l2ZScpKVxuXHRcdFx0dGhpcy5vcHRzLmN0cmxMb2FkUmVjdXJzaXZlID0gdHJ1ZTtcblxuXHRcdGlmICh0aGlzLm9wdHMuaGFzT3duUHJvcGVydHkoJ2N0cmxJZ25vcmUnKSlcblx0XHR7XG5cdFx0XHR0aGlzLm9wdHMuY3RybElnbm9yZSA9IHRoaXMub3B0cy5jdHJsSWdub3JlIGluc3RhbmNlb2YgUmVnRXhwID9cblx0XHRcdFx0dGhpcy5vcHRzLmN0cmxJZ25vcmUgOiBuZXcgUmVnRXhwKGAke3RoaXMub3B0cy5jdHJsSWdub3JlfWApO1xuXHRcdH1cblxuXHRcdGlmICghdGhpcy5vcHRzLmhhc093blByb3BlcnR5KCdtZXJnZVBhcmFtcycpKVxuXHRcdFx0dGhpcy5vcHRzLm1lcmdlUGFyYW1zID0gdHJ1ZTtcblxuXHRcdGlmICh0aGlzLm9wdHMuaGFzT3duUHJvcGVydHkoJ3JvdXRlQ29uZmlnJykpXG5cdFx0XHR0aGlzLm9wdHMucm91dGVDb25maWcoYXBwKTtcblxuXHRcdGlmICghdGhpcy5vcHRzLmhhc093blByb3BlcnR5KCdkZWJ1ZycpKVxuXHRcdFx0dGhpcy5vcHRzLmRlYnVnID0gZmFsc2U7XG5cdH1cblxuXHQvKipcblx0ICogTG9hZCBhbmQgaW5zdGFudGlhdGUgQVBJIGNvbnRyb2xsZXJzIGFuZCBjb25maWd1cmUgcm91dGVzIGZvciBlYWNoXG5cdCAqIEBwYXJhbSBhcHBcblx0ICogQHJldHVybnMge3ZvaWR9XG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRwcml2YXRlIF9sb2FkQ29udHJvbGxlcnMoYXBwOmFueSk6dm9pZFxuXHR7XG5cdFx0Y29uc3Qgb3B0cyA9IHRoaXMub3B0cyxcblx0XHRcdEVYVF9QQVRURVJOOlJlZ0V4cCA9IC9cXC5bdHxqXXM/Lyxcblx0XHRcdENUUkxfUEFUVEVSTjpSZWdFeHAgPSAvY29udHJvbGxlci8sXG5cdFx0XHRNQVBfUEFUVEVSTjpSZWdFeHAgPSAvXFwubWFwJC8sXG5cdFx0XHRBUElfRElSOnN0cmluZyA9IG9wdHMuY3RybERpcixcblx0XHRcdElHTk9SRV9QQVRURVJOOlJlZ0V4cCA9IG9wdHMuY3RybElnbm9yZSB8fCBudWxsO1xuXG5cdFx0dHJ5XG5cdFx0e1xuXHRcdFx0Ly8gR2V0IGxpc3Qgb2YgZmlsZXMgaW4gY29udHJvbGxlcnMgZGlyZWN0b3J5XG5cdFx0XHRsZXQgYXBpQ29udGVudHM6c3RyaW5nW10gPSBmc0hlbHBlci5HZXREaXJlY3RvcnlDb250ZW50cyhBUElfRElSLCBvcHRzLmN0cmxMb2FkUmVjdXJzaXZlKTtcblxuXHRcdFx0YXBpQ29udGVudHMuZmlsdGVyKChmaWxlOmFueSkgPT5cblx0XHRcdHtcblx0XHRcdFx0cmV0dXJuIGZpbGUuZmlsZU5hbWUuaW5kZXhPZihvcHRzLmV4dGVuc2lvbikgIT09IC0xO1xuXHRcdFx0fSkuZm9yRWFjaCgoZmlsZTphbnkpID0+XG5cdFx0XHR7XG5cdFx0XHRcdC8vIEdldCBmaWxlIG5hbWUgd2l0aG91dCBleHRlbnNpb24gYW5kIG1ha2Ugc3VyZSBCYXNlQ29udHJvbGxlciBpcyBza2lwcGVkXG5cdFx0XHRcdGxldCBmaWxlTmFtZTpzdHJpbmcgPSBmaWxlLmZpbGVOYW1lXG5cdFx0XHRcdFx0LnJlcGxhY2UoRVhUX1BBVFRFUk4sICcnKVxuXHRcdFx0XHRcdC5yZXBsYWNlKCdCYXNlQ29udHJvbGxlcicsICcnKTtcblxuXHRcdFx0XHQvLyBJZiB0aGUgZmlsZSBpcyBhIENvbnRyb2xsZXIgYW5kIG5vdCBhIC5tYXAgZmlsZVxuXHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0Q1RSTF9QQVRURVJOLnRlc3QoZmlsZU5hbWUudG9Mb3dlckNhc2UoKSkgJiZcblx0XHRcdFx0XHQhTUFQX1BBVFRFUk4udGVzdChmaWxlTmFtZSkgJiZcblx0XHRcdFx0XHQoIUlHTk9SRV9QQVRURVJOIHx8ICFJR05PUkVfUEFUVEVSTi50ZXN0KGZpbGVOYW1lKSlcblx0XHRcdFx0KVxuXHRcdFx0XHR7XG5cdFx0XHRcdFx0Ly8gQ29uc3RydWN0IHJlbGF0aXZlIHBhdGggZm9yIHJlcXVpcmUoKSBjYWxsXG5cdFx0XHRcdFx0bGV0IHBhdGggPSBmaWxlLmZ1bGxQYXRoXG5cdFx0XHRcdFx0XHQucmVwbGFjZShgJHtBUElfRElSfS9gLCAnJylcblx0XHRcdFx0XHRcdC5yZXBsYWNlKGZpbGUuZmlsZU5hbWUsICcnKVxuXHRcdFx0XHRcdFx0LnJlcGxhY2Uob3B0cy5jdHJsSWdub3JlLCAnJyk7XG5cblx0XHRcdFx0XHR0cnlcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHQvLyBJbnN0YW50aWF0ZSB0aGUgY29udHJvbGxlclxuXHRcdFx0XHRcdFx0bGV0XHRjdHJsQ29uc3RydWN0b3I6YW55ID0gcmVxdWlyZShgJHtBUElfRElSfS8ke3BhdGh9LyR7ZmlsZU5hbWV9YCksXG5cdFx0XHRcdFx0XHRcdGN0cmxOYW1lOnN0cmluZyA9IE9iamVjdC5rZXlzKGN0cmxDb25zdHJ1Y3RvcilbMF0sXG5cdFx0XHRcdFx0XHRcdGNvbnRyb2xsZXI6QmFzZUNvbnRyb2xsZXJ8YW55ID0gbmV3IGN0cmxDb25zdHJ1Y3RvcltjdHJsTmFtZV07XG5cblx0XHRcdFx0XHRcdC8vICRyb3V0ZXMgcHJvcGVydHkgaXMgYWRkZWQgdG8gZWFjaCBjb250cm9sbGVyIHZpYSB0aGUgRW5kUG9pbnRSb3V0aW5nIGRlY29yYXRvcnNcblx0XHRcdFx0XHRcdC8vIExvb3AgdGhlICRyb3V0ZXMgYW5kIGF0dGFjaCBlYWNoIHRvIHRoZSBwcm9wZXIgY29udHJvbGxlciBhY3Rpb25cblx0XHRcdFx0XHRcdGZvciAoY29uc3QgeyBtZXRob2QsIG1vdW50cGF0aCwgcGF0aCwgbWlkZGxld2FyZSwgcmVxdWlyZWRCb2R5UGFyYW1zLCBmbk5hbWUgfSBvZiBjb250cm9sbGVyLiRyb3V0ZXMpXG5cdFx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRcdC8vIFNldCB0aGUgbW91bnRwYXRoIGZvciBFeHByZXNzXG5cdFx0XHRcdFx0XHRcdGFwcC51c2UoXG5cdFx0XHRcdFx0XHRcdFx0bW91bnRwYXRoLFxuXHRcdFx0XHRcdFx0XHRcdHRoaXMuX3JvdXRlckFkZChvcHRzLCBtZXRob2QsIG1vdW50cGF0aCwgcGF0aCwgbWlkZGxld2FyZSwgZm5OYW1lLCBjb250cm9sbGVyKVxuXHRcdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBERUJVRzogbG9nIGNvbnRyb2xsZXIgcm91dGVzXG5cdFx0XHRcdFx0XHRpZiAob3B0cy5kZWJ1Zylcblx0XHRcdFx0XHRcdHtcblx0XHRcdFx0XHRcdFx0TG9nKG51bGwsICdkZWJ1ZycsIG9wdHMsIGBSb3V0ZXMgZm9yICR7Y3RybE5hbWV9YCk7XG5cdFx0XHRcdFx0XHRcdGNvbnRyb2xsZXIuJHJvdXRlcy5mb3JFYWNoKChyb3V0ZTphbnkpID0+IGNvbnNvbGUubG9nKHV0aWwuaW5zcGVjdChyb3V0ZSkpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Y2F0Y2goZSlcblx0XHRcdFx0XHR7XG5cdFx0XHRcdFx0XHRMb2coZSwgJ2Vycm9yJywgdGhpcy5vcHRzLCBgY29uZmlndXJpbmcgcm91dGVzIGZvciAke2ZpbGVOYW1lfWApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGNhdGNoKGUpXG5cdFx0e1xuXHRcdFx0TG9nKGUsICdlcnJvcicsIHRoaXMub3B0cyk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBfcm91dGVyQWRkKG9wdHM6SUV4cHJlc3NEZWNvcmF0ZU9wdGlvbnMsIG1ldGhvZDpzdHJpbmcsIG1vdW50cGF0aDpzdHJpbmcsIHBhdGg6c3RyaW5nLFxuXHRcdFx0XHRcdCAgIG1pZGRsZXdhcmU6YW55W10sIGZuTmFtZTpzdHJpbmcsIGNvbnRyb2xsZXI6YW55KTpSb3V0ZXJcblx0e1xuXHRcdC8vIG1lcmdlUGFyYW1zIGFsbG93cyB1cyB0byBoYXZlIGEgcGF0aCBwYXJhbWV0ZXIgaW4gdGhlIG1vdW50cGF0aCB0aGF0IHdpbGwgdGhlbiBzaG93XG5cdFx0Ly8gaW4gdGhlIEV4cHJlc3MgcmVxdWVzdCBvYmplY3QgdmlhIHJlcS5wYXJhbXNcblx0XHRsZXQgcm91dGVyOmFueSA9IFJvdXRlcih7IG1lcmdlUGFyYW1zOiBvcHRzLm1lcmdlUGFyYW1zIH0pO1xuXG5cdFx0Ly8gQXR0YWNoIHJvdXRlciwgbWlkZGxld2FyZSBhbmQgY29udHJvbGxlciBhY3Rpb24gdG8gbW91bnRwYXRoXG5cdFx0cm91dGVyW21ldGhvZCA9PT0gJ2FsdGVybmF0ZScgPyBvcHRzLmFsdGVybmF0ZU1ldGhvZCA6IG1ldGhvZF0ocGF0aCwgLi4ubWlkZGxld2FyZSwgY29udHJvbGxlcltmbk5hbWVdKTtcblxuXHRcdHJldHVybiByb3V0ZXI7XG5cdH1cbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
